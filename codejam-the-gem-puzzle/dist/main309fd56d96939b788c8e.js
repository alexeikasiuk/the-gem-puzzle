(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();const e=t.p+"26cc815935261f3f655a.mp3";let s=new class{constructor(){this.level=4,this.movesCount=0,this.time={m:0,s:0},this.puzzleItems=[],this.hasSound=!0,this.isMove=!1,this.savedPuzzleItemsOrder=null,this.isWin=!1,this.isHelped=!1}init(){this.savedGame=JSON.parse(localStorage.getItem("game")),this.savedGame?this.createPage():this.loadGame()}loadGame(){this.createPage(),this.setButtonsBehavior(),this.startGame()}startGame(){this.fillField(),this.setPuzzleItemsBehavior(),this.setCurPageData(),this.timerId=setInterval((()=>{this.time.s++,this.showCurTime()}),1e3)}restartGame(){!this.isWin&&this.movesCount>0?(this.puzzle.innerHTML='\n        <div class="save-modal">\n          <h3>Do you want to save this game?</h3>\n          <div>\n          <button id="save-this-game">YES</button>\n          <button id="remove-game">NO</button>\n          </div>\n      </div>\n      ',document.getElementById("save-this-game").onclick=()=>{this.saveGame(),this.clearGameState(),this.loadGame()},document.getElementById("remove-game").onclick=()=>{localStorage.removeItem("game"),this.clearGameState(),this.loadGame()}):(this.clearGameState(),this.loadGame())}saveGame(){let t={moves:this.movesCount,time:this.time,level:this.level,puzzle:[]};this.puzzleItems.forEach((e=>t.puzzle.push(+e.innerHTML))),localStorage.setItem("game",JSON.stringify(t))}showResults(){let t=localStorage.getItem("results"),e=document.createElement("table");if(e.classList.add("table-results"),this.modalResults.classList.add("show"),t){e.insertAdjacentHTML("afterbegin","\n        <tr>\n          <th>№</th>\n          <th>Date</th>\n          <th>Help</th>\n          <th>Moves</th>\n          <th>Time</th>\n        </tr>\n      "),t=JSON.parse(t);for(let s in t){if(0==t[s].length)continue;let i=document.createElement("tr");i.insertAdjacentHTML("afterbegin",`\n          <td colspan="5"><h3>Game Level: ${s}x${s}</h3></td>\n        `),e.append(i),t[s].forEach(((t,s)=>{let i,n=document.createElement("tr"),a=new Date(t.date),o=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,l=a.getDate()<10?"0"+a.getDate():a.getDate(),d=a.getHours()<10?"0"+a.getHours():a.getHours(),h=a.getMinutes()<10?"0"+a.getMinutes():a.getMinutes();switch(a.getDay()){case 0:i="вс";break;case 1:i="пн";break;case 2:i="вт";break;case 3:i="ср";break;case 4:i="чт";break;case 5:i="пт";break;case 6:i="сб"}n.insertAdjacentHTML("afterbegin",`\n              <td>${s+1}</td>\n              <td>${l}.${o} ${i}, ${d}:${h}</td>\n              <td>${t.help?"yes":"no"}</td>\n              <td>${t.moves}</td>\n              <td>${t.time.m}:${t.time.s}</td>\n          `),e.append(n)}))}}else e.innerHTML="You have no saved game's results";let s=document.querySelector(".modal-results").querySelector(".modal-content");s.innerHTML="",s.append(e)}showCurTime(){60===this.time.s&&(this.time.s=0,this.time.m++),60===this.time.m&&alert("game over");let t=this.time.m<10?`0${this.time.m}`:this.time.m,e=this.time.s<10?`0${this.time.s}`:this.time.s;this.timeNode.innerHTML=`${t}:${e}`}setCurPageData(){this.movesCountNode.innerHTML=this.movesCount,this.levelNode.innerHTML=`${this.level}&times;${this.level}`,this.showCurTime(),this.levelButtons.forEach((t=>+t.getAttribute("data-size")===this.level?t.classList.add("disabled"):t.classList.remove("disabled")))}createPage(){document.body.innerHTML="",document.body.insertAdjacentHTML("afterbegin",'\n    <div class="container">\n      <h1>RSS Gem Puzzle</h1>\n      <div class="game-window">\n        <div class="controls">\n          <button class="control-btn" id="start-game">Restart</button>\n          <button class="control-btn" id="help">Let\'s win!</button>\n          <button class="control-btn" id="save-game">Save</button>\n          <button class="control-btn" id="get-result">Result</button>\n          <button class="sound" id="sound"></button>       \n        </div>\n        <div class="info">\n          <div class=""moves>\n            <span>Moves:</span>\n            <span id="moves-count">-</span>\n          </div>\n          <div class="field-size">\n            <span>Level:</span>\n            <span id="cells-size">-&times;-</span>\n          </div>\n          <div class="duration">\n            <span>Time:</span>\n            <span id="time">--:--</span>\n          </div>\n        </div>\n        <div class="field-window">\n          <div class="field">\n            <div class="saved-game">\n              <h2>Do you want to continue the last saved game?</h2>\n              <div>\n                <button id="play-last-game">YES</button>\n                <button id="remove-saved-game">NO</button>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="levels">\n          <button data-size="3">3&times;3</button>\n          <button data-size="4">4&times;4</button>\n          <button data-size="5">5&times;5</button>\n          <button data-size="6">6&times;6</button>\n          <button data-size="7">7&times;7</button>\n          <button data-size="8">8&times;8</button>\n        </div>\n        <div class="modal modal-results">\n          <div class="modal-body">\n          <button class="modal-close-btn"id="modal-results-close">&times;</button>\n            <h2 class="modal-title">Top-10 results</h2>\n            <button class="clear-results" id="clear-results">Clear</button>\n            <div class="modal-content"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  '),this.levelButtons=document.querySelector(".levels").querySelectorAll("button"),this.restartButton=document.getElementById("start-game"),this.saveButton=document.getElementById("save-game"),this.showResultButton=document.getElementById("get-result"),this.soundButton=document.getElementById("sound"),this.helpButton=document.getElementById("help"),this.clearResults=document.getElementById("clear-results"),this.movesCountNode=document.getElementById("moves-count"),this.levelNode=document.getElementById("cells-size"),this.timeNode=document.getElementById("time"),document.getElementById("play-last-game").onclick=t=>{this.setSavedGameData(),this.loadGame(),localStorage.removeItem("game")},document.getElementById("remove-saved-game").onclick=t=>{localStorage.removeItem("game"),this.loadGame()},this.modalResults=document.querySelector(".modal-results"),this.modalResultsBtnClose=document.getElementById("modal-results-close"),this.modalResultsBtnClose.onclick=()=>this.modalResults.classList.remove("show")}setButtonsBehavior(){this.levelButtons.forEach((t=>{t.onclick=()=>{t.classList.contains("disabled")||(!this.isWin&&this.movesCount>0?(this.puzzle.innerHTML='\n        <div class="save-modal">\n          <h3>Do you want to save this game?</h3>\n          <div>\n          <button id="save-this-game">YES</button>\n          <button id="remove-game">NO</button>\n          </div>\n      </div>\n      ',document.getElementById("save-this-game").onclick=()=>{this.saveGame(),this.clearGameState(),this.level=+t.getAttribute("data-size"),this.loadGame()},document.getElementById("remove-game").onclick=()=>{localStorage.removeItem("game"),this.clearGameState(),this.level=+t.getAttribute("data-size"),this.loadGame()}):(this.clearGameState(),this.level=+t.getAttribute("data-size"),this.loadGame()))}})),this.restartButton.onclick=()=>{this.restartButton.classList.contains("disabled")||this.restartGame()},this.helpButton.onclick=()=>{this.helpButton.classList.contains("disabled")||this.helpMe()},this.saveButton.onclick=()=>this.saveGame(),this.showResultButton.onclick=()=>this.showResults(),this.soundButton.onclick=()=>{this.hasSound=!this.hasSound,this.soundButton.classList.toggle("disabled")},this.clearResults.onclick=()=>{localStorage.removeItem("results"),this.showResults()}}fillField(){if(this.puzzle=document.querySelector(".field"),this.puzzleCoord={left:Math.round(this.puzzle.getBoundingClientRect().x),top:Math.round(this.puzzle.getBoundingClientRect().y),width:this.puzzle.offsetWidth,height:this.puzzle.offsetHeight},this.puzzle.classList.add(`grid-${this.level}`),this.puzzleItems=[],this.savedPuzzleItemsOrder)for(let t=0;t<this.level*this.level;t++){let e=document.createElement("div");e.innerHTML=this.savedPuzzleItemsOrder[t],0===this.savedPuzzleItemsOrder[t]&&e.classList.add("zero-cell"),e.classList.add("cell"),this.puzzleItems.push(e)}else{for(let t=0;t<this.level*this.level;t++){let e=document.createElement("div");e.innerHTML=t,0===t&&e.classList.add("zero-cell"),e.classList.add("cell"),this.puzzleItems.push(e)}this.puzzleItems=this.shuffle(this.puzzleItems)}this.savedPuzzleItemsOrder=null,this.puzzle.innerHTML="",this.puzzleItems.forEach((t=>this.puzzle.append(t)))}setPuzzleItemsBehavior(){this.puzzleItems.forEach((t=>{t.addEventListener("mousedown",(e=>{e.preventDefault();let s=this;if(this.isMove||this.isStopped||this.draggedItem)return;let i=document.querySelector(".zero-cell"),n={x:Math.round(t.getBoundingClientRect().x),y:Math.round(t.getBoundingClientRect().y),minLeft:s.puzzleCoord.left-Math.round(t.getBoundingClientRect().x),maxLeft:s.puzzleCoord.left+s.puzzleCoord.width-t.offsetWidth-Math.round(t.getBoundingClientRect().x),minTop:s.puzzleCoord.top-Math.round(t.getBoundingClientRect().y),maxTop:s.puzzleCoord.top+s.puzzleCoord.height-t.offsetHeight-Math.round(t.getBoundingClientRect().y),maxX:0,maxY:0},a=Math.round(i.getBoundingClientRect().x),o=Math.round(i.getBoundingClientRect().y),l=n.x-a,d=n.y-o,h=1.5*t.offsetWidth;if(!(0==d&&Math.abs(l)<=h||0==l&&Math.abs(d)<=h))return;this.isMove=!0,this.draggedItem=t,this.draggedItem.data=n,this.draggedItem.time=Date.now(),this.draggedItem.position={left:0,top:0},this.draggedItem.style.position="relative",this.draggedItem.style.zIndex="1000";let m=this.mouseCurCoord;this.draggedTimer=setInterval((()=>{this.draggedItem.position.left+=this.mouseCurCoord.x-m.x,this.draggedItem.position.top+=this.mouseCurCoord.y-m.y,this.draggedItem.position.left<n.minLeft?this.draggedItem.position.left=n.minLeft:this.draggedItem.position.left>n.maxLeft&&(this.draggedItem.position.left=n.maxLeft),this.draggedItem.position.top<n.minTop?this.draggedItem.position.top=n.minTop:this.draggedItem.position.top>n.maxTop&&(this.draggedItem.position.top=n.maxTop),n.maxX=Math.max(n.maxX,Math.abs(this.draggedItem.position.left)),n.maxY=Math.max(n.maxY,Math.abs(this.draggedItem.position.left)),this.draggedItem.style.left=this.draggedItem.position.left+"px",this.draggedItem.style.top=this.draggedItem.position.top+"px",m=this.mouseCurCoord}),10)}))})),document.onmouseup=t=>{if(!this.draggedItem||!this.isMove)return;clearInterval(this.draggedTimer);let s=Date.now()-this.draggedItem.time,i=Math.max(this.draggedItem.data.maxX,this.draggedItem.data.maxY),n=document.querySelector(".zero-cell"),a=Math.round(this.draggedItem.getBoundingClientRect().x),o=Math.round(this.draggedItem.getBoundingClientRect().y),l=Math.round(n.getBoundingClientRect().x),d=Math.round(n.getBoundingClientRect().y),h=a-l,m=o-d,r=this.draggedItem.offsetWidth;this.draggedItem.classList.add("slow"),Math.abs(h)<=r&&Math.abs(m)<=r||s<300&&i<20?(this.draggedItem.style.left=parseInt(this.draggedItem.style.left)+l-a+"px",this.draggedItem.style.top=parseInt(this.draggedItem.style.top)+d-o+"px",this.playSound(e),setTimeout((()=>{n.innerHTML=this.draggedItem.innerHTML,this.draggedItem.innerHTML=0,this.draggedItem.classList.add("zero-cell"),n.classList.remove("zero-cell"),this.draggedItem.style.zIndex="0",this.draggedItem.style.top="0",this.draggedItem.style.left="0",this.draggedItem.style.position="static",this.draggedItem.classList.remove("slow"),this.draggedItem=null,this.isMove=!1,this.movesCount++,this.movesCountNode.innerHTML=this.movesCount,this.checkGameState()}),100)):(this.draggedItem.style.top="0",this.draggedItem.style.left="0",this.timerMoveBack=setTimeout((()=>{this.draggedItem.classList.remove("slow"),this.draggedItem.style.zIndex="0",this.draggedItem.style.position="static",this.draggedItem=null,this.isMove=!1,this.playSound(e),clearTimeout(this.timerMoveBack)}),100))},document.onmousemove=t=>{this.mouseCurCoord={x:t.clientX,y:t.clientY}}}shuffle(t){let e=[].concat(t);for(let s=t.length-1;s>0;s--){let t=Math.floor(Math.random()*(s+1));[e[s],e[t]]=[e[t],e[s]]}return e}playSound(t){this.hasSound&&new Audio(t).play()}clearGameState(){this.time={m:0,s:0},this.movesCount=0,this.isHelped=!1,this.puzzleItems=[],this.isWin=!1,this.puzzle.innerHTML="",this.timerId&&clearInterval(this.timerId)}setSavedGameData(){this.level=this.savedGame.level,this.movesCount=this.savedGame.moves,this.time=this.savedGame.time,this.savedPuzzleItemsOrder=this.savedGame.puzzle}checkGameState(){let t=this.puzzleItems.map((t=>+t.innerHTML));t=[].concat(t.slice(t.length-1),t.slice(0,t.length-1));let e=[].concat(t).sort(((t,e)=>t-e));t.join("")==e.join("")&&(this.isWin=!0,this.saveWinGame(),clearInterval(this.timerId),this.saveButton.classList.add("disabled"),this.helpButton.classList.add("disabled"),this.showWinMessage())}helpMe(){this.isHelped=!0,this.puzzleItems=this.puzzleItems.sort(((t,e)=>+t.innerHTML-+e.innerHTML));let t=this.puzzleItems[0];this.puzzleItems=this.puzzleItems.slice(1),this.puzzleItems.splice(this.puzzleItems.length-1,0,t),this.puzzle.innerHTML="",this.puzzleItems.forEach((t=>this.puzzle.append(t))),this.movesCount++,this.movesCountNode.innerHTML=this.movesCount}saveWinGame(){let t=localStorage.getItem("results")?JSON.parse(localStorage.getItem("results")):{3:[],4:[],5:[],6:[],7:[],8:[]},e={date:Date.now(),help:this.isHelped,moves:this.movesCount,time:this.time};e.help?t[this.level.toString()].push(e):t[this.level.toString()].unshift(e),t[this.level.toString()].sort(((t,e)=>{if(!t.help&&e.help)return-1;if(t.help&&!e.help)return 1;if(t.moves>e.moves)return 1;if(t.moves<e.moves)return-1;{let s=60*t.time.m+t.time.s,i=60*e.time.m+e.time.s;return s>i?1:s<i?-1:e.date-t.date}})),t[this.level.toString()].length>10&&(t[this.level.toString()]=t[this.level.toString()].slice(0,10)),localStorage.setItem("results",JSON.stringify(t))}showWinMessage(){this.puzzle.innerHTML=`\n    <div class="win-modal">\n      <h3>\n        <p>Hooray!</p>\n        \n      </h3>\n      <p>\n          You solved the puzzle in ${this.time.m<10?"0"+this.time.m:this.time.m}:${this.time.s<10?"0"+this.time.s:this.time.s} and ${this.movesCount} moves!</p>\n      <p>${this.isHelped?"Unfortunately, You cheated!!!":""}</p>\n    </div>\n    `}};s.init(),window.onunload=()=>{!s.isWin&&s.movesCount>0&&s.saveGame()}})();